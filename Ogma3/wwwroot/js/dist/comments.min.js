let comments_vue=new Vue({el:"#comments-container",data:{body:null,thread:null,route:null,csrf:null,comments:[],visibleComments:[],page:1,perPage:10,highlight:null},methods:{submit:function(t){t.preventDefault(),axios.post(this.route,{body:this.body,thread:Number(this.thread)},{headers:{RequestVerificationToken:this.csrf}}).then(t=>{this.load(),this.body=null}).catch(console.error)},load:function(){axios.get(this.route,{params:{thread:this.thread}}).then(t=>{this.comments=t.data.map((t,e)=>({val:t,key:e})).reverse(),this.highlight?this.navigateToComment():this.navigateToPage()}).catch(console.error)},enter:function(t){t.ctrlKey&&this.submit(t)},date:function(t){return dayjs(t).format("DD MMM YYYY, HH:mm")},prevPage:function(){this.page=Math.max(1,this.page-1),this.navigateToPage()},nextPage:function(){this.page=Math.min(this.page+1,Math.ceil(this.comments.length/this.perPage)),this.navigateToPage()},changePage:function(t){this.page=t,this.navigateToPage()},changeHighlight:function(t=null,e){e.preventDefault(),this.highlight=t??this.highlight,document.getElementById("comment-"+this.highlight).scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),history.replaceState(void 0,void 0,"#comment."+t)},navigateToPage:function(){this.visibleComments=this.comments.slice((this.page-1)*this.perPage,this.page*this.perPage),console.log(this.page),this.page>1?history.replaceState(null,null,"#page."+this.page):history.replaceState(null,null,window.location.href.split("#")[0]),this.highlight&&(this.highlight=null)},navigateToComment:function(){let t=this.comments.findIndex(t=>t.key+1===this.highlight);this.page=Math.floor(t/this.perPage)+1,this.visibleComments=this.comments.slice((this.page-1)*this.perPage,this.page*this.perPage),Vue.nextTick((function(){comments_vue.changeHighlight()}))}},mounted(){this.thread=document.getElementById("thread").dataset.thread,this.route=document.getElementById("route").dataset.route,this.csrf=document.querySelector("input[name=__RequestVerificationToken]").value;let t=window.location.hash.split(".");"#page"===t[0]&&t[1]?this.page=Math.max(1,Number(t[1]??1)):"#comment"===t[0]&&t[1]?this.highlight=Number(t[1]):history.replaceState(void 0,void 0,""),this.load()}});
//# sourceMappingURL=comments.min.js.map
