let comments_vue=new Vue({el:"#comments-container",data:{body:"",thread:null,route:null,csrf:null,maxLength:null,comments:[],total:0,page:null,perPage:null,opName:null,highlight:null,collapse:JSON.parse(window.localStorage.getItem("collapse-deleted"))},methods:{submit:function(t){if(t.preventDefault(),this.body.length>=this.maxLength)return;let e={body:this.body,thread:Number(this.thread)};axios.post(this.route,e,{headers:{RequestVerificationToken:this.csrf}}).then((t=>{this.highlight=this.total+1,this.page=1,this.load(),this.body=""})).catch(console.error)},load:function(){const t={thread:this.thread,page:this.page,highlight:this.highlight};axios.get(this.route,{params:t}).then((t=>{this.total=t.data.total,this.page=t.data.page??this.page,this.comments=t.data.elements.map(((e,h)=>({val:e,key:t.data.total-this.page*this.perPage+(this.perPage-(h+1))}))),this.highlight?Vue.nextTick((t=>comments_vue.changeHighlight())):this.navigateToPage()})).catch(console.error)},enter:function(t){t.ctrlKey&&this.submit(t)},prevPage:function(){let t=Math.max(1,this.page-1);this.changePage(t)},nextPage:function(){let t=Math.min(this.page+1,Math.ceil(this.total/this.perPage));this.changePage(t)},changePage:function(t){this.page=t,this.navigateToPage(),this.load()},changeHighlight:function(t=null,e=null){e&&e.preventDefault(),this.highlight=t??this.highlight,document.getElementById(`comment-${this.highlight}`).scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),history.replaceState(void 0,void 0,`#comment-${this.highlight}`)},navigateToPage:function(){this.page>1?history.replaceState(null,null,`#page-${this.page}`):history.replaceState(null,null,window.location.href.split("#")[0]),this.highlight&&(this.highlight=null)},report:function(t){this.$refs.reportModal.mutId=t,this.$refs.reportModal.visible=!0}},computed:{comms:function(){if(!0!==this.collapse)return this.comments;let t=[],e=0;for(const h of this.comments)h.val.deletedBy?e+=1:(0!==e&&t.push({snip:`Removed ${e} comments.`}),e=0,t.push(h));return t}},mounted(){this.thread=document.getElementById("thread").dataset.thread,this.route=document.getElementById("route").dataset.route,this.perPage=document.getElementById("per-page").dataset.count,this.maxLength=document.getElementById("max-length").dataset.length,this.csrf=document.querySelector("input[name=__RequestVerificationToken]").value;let t=window.location.hash.split("-");"#page"===t[0]&&t[1]?this.page=Math.max(1,Number(t[1]??1)):"#comment"===t[0]&&t[1]?(this.page=1,this.highlight=Number(t[1])):(this.page=1,history.replaceState(void 0,void 0,"")),this.load()}});
//# sourceMappingURL=comments.min.js.map
