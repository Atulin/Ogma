@page
@using Ogma3.Data.Enums
@model Ogma3.Pages.Blog.SearchModel

@{
    ViewData["Title"] = "Blogpost search";
}

<form id="search" class="search" method="GET">
    <label for="title">Query</label>
    <input class="active-border" id="title" name="q" type="text" value="@Model.SearchBy">
    
    <label for="sort">Sort</label>
    <select class="active-border"
            name="sort"
            id="sort"
            asp-for="SortBy"
            asp-items="Html.GetEnumSelectList<EBlogpostSortingOptions>()">
    </select>
    
    <input class="active-border" type="submit" value="Search">
</form>

@if (Model.Posts.Count <= 0)
{
    <h1>No blog posts found</h1>
}
else
{
    @foreach (var post in Model.Posts) {
        <partial name="_BlogpostCard" model="@post"></partial>
    }
    
    @if (Model.PostsCount > Model.PerPage)
    {
        <div class="pagination">
            <a class="prev button" href="?page=@(Math.Max(1, Model.PageNumber - 1))">Previous</a>
            @if (Model.PageNumber > 5)
            {
                <div class="ph button">...</div>
            }
            @for (var i = 1; i <= (int)Math.Ceiling((double)Model.PostsCount / Model.PerPage); i++)
            {
                @if (i >= Model.PageNumber - 4 && i <= Math.Max(Model.PageNumber, 5))
                {
                    <a href="?page=@i"
                       class="page button @(i == Model.PageNumber ? "active" : "")">
                        @i
                    </a>
                }
            }
            @if (Model.PostsCount / Model.PerPage > 5 && Model.PageNumber != Model.PostsCount / Model.PerPage)
            {
                <div class="ph button">...</div>
            }
            <a class="next button" href="?page=@(Math.Min(Model.PageNumber + 1, (int)Math.Ceiling((double)Model.PostsCount / Model.PerPage)))">Next</a>
        </div>
    }
}